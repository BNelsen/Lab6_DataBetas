---
title: "Lab6_DataBetas"
author: "Brandon Nelsen, Burke Parent, Drew Hoffman, David Washburn, Tanner Ball"
date: "10/2/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
library(tidyverse)
COflights <- read_csv("https://files.osf.io/v1/resources/3z5as4pej8/providers/osfstorage/5a8ca28f57103100104584db")
```


# Overall Questions, Significance of Overall Questions:


# Team Plots & Questions:


# Team Recommended Course of Action:

# Individual Sections:

***Tanner's Plot:***

I chose to look at how often a particular airline arrives in Denver later than scheduled. I first got the total number of late flights in Denver, sorted by airline, then I got the total number of flights that landed in Denver, also sorted by airline. Then I created a new table that contains both of these numbers for each carrier, then added a new variable for the probability of a late arrival in Denver for a given airline.

```{r}
# count the number of delayed flights to Denver
carrierDelay <- filter(COflights, DEST == 'DEN', ARR_DELAY >= 15, !is.na(ARR_DELAY)) %>% group_by(CARRIER) %>% summarise('total' = n())

# count the total number of planes landing in Denver in the dataset
landed <- filter(COflights, DEST == 'DEN', !is.na(ARR_TIME)) %>% group_by(CARRIER) %>% summarise('total' = n())

# create a new table with the delay and total landed for all carriers
merged <- merge(carrierDelay, landed, by="CARRIER")
# add a new column that calculates the probability of a delayed arrival to Denver by carrier
merged <- mutate(merged, probCarrierDelay = total.x/total.y)

ggplot(data = merged,aes(x = CARRIER, y = probCarrierDelay)) + geom_point() + geom_text(aes(label=signif(probCarrierDelay, digits = 3)), hjust=-.25, vjust=0) + xlab('Airline') + ylab('Probability of an Arrival Delay') + ggtitle('The Probability of an Arrival Delay in Denver by Airline')
```

After plotting the results, we can see that the airlines with the highest likelihood of a late arrival in Denver in 2017 were B6 (JetBlue) and VX (Virgin America). These two carriers were much more likely to be late than the rest of the carriers in the dataset, so I was curious about potential reasons for this. I chose to look at the origin of these airlines' flights to Denver:

```{r}
B6origins <- filter(COflights, DEST == 'DEN', CARRIER == 'B6') %>% group_by(ORIGIN) %>% summarise('total' = n())

VXorigins <- filter(COflights, DEST == 'DEN', CARRIER == 'VX') %>% group_by(ORIGIN) %>% summarise('total' = n())

B6origins
VXorigins
```

As we can see, JetBlue flies to Denver exclusively from JFK in Queens, NY and BOS in Boston, MA, while Virgin America flies to Denver exclusively from SFO in San Francisco, CA. Potential reasons for the late arrivals, then, could be the flight time (since these are all pretty long flights), or it could be due to how busy these three airports are.

***David's Plot:***

Findings: I used the data to determine how Christmas effected delays at DIA. I calculated the probability of a flight being delayed the week of Christmas by creating multiple subsets of the data and creating a new variable that determined if a flight was delayed. The probability of a flight being delayed Christmas week turned out to be 26.7%. The probability of a flight being delayed in december was 18.3% and the probability of any flight being delayed throughout all months was 17.1%. Hence, it is easy to see that the Christmas holiday has an effect on the chances of a flight being delayed. This is supported by the histogram which shows that the most amount of delayed flights occured on December 21st.

```{r}
#Create a variable specific to Denver

DENflights <- 
  COflights %>%
  filter(ORIGIN == 'DEN' | DEST == 'DEN')

#Delayed arrivals in Denver
#Create an operator that determines if a flight had a delayed arrival

DelayedOperator <-
  mutate(DENflights, Delayed = ARR_DELAY >= 15)

#Show only the delayed flights

DelayedDENFlights <-
    filter(DelayedOperator, Delayed == TRUE)


#How do major holidays effect arrivals?

DelayedDecemberFlights <-
  filter(DelayedDENFlights, MONTH == 12)

#Calulate the probabliity a flight was delayed on the week of Christmas (Dec.18-Dec.25)
# P(Delayed Christmas Week) = Delays Christmas Week/ Number of Flights Christmas Week

DelayedChristmasWeek <-
  filter(DelayedDecemberFlights, DAY_OF_MONTH %in% c(18,19,20,21,22,23,24,25))

FlightsChristmasWeek <-
  filter(DENflights, MONTH == 12, DAY_OF_MONTH %in% c(18,19,20,21,22,23,24,25))

nrow(DelayedChristmasWeek)/nrow(FlightsChristmasWeek)

## [1] 0.2673465

#Probability of any flight being delayed

nrow(DelayedDENFlights)/nrow(DENflights)

## [1] 0.1709883

#probability of a December flight being delayed

DecemberFlights <-
  filter(DENflights, MONTH == 12)

nrow(DelayedDecemberFlights)/nrow(DecemberFlights)

## [1] 0.1826364

#P(Delayed Christmas Week) = 26.7%, P(Any flight being Delayed) = 17.1%, P(December Flight being delayed) = 18.3%

#Create a plot that shows there are more delays Christmas Week oppose to the rest of December

ggplot(DelayedDecemberFlights, aes(x = DAY_OF_MONTH)) +
  geom_histogram(color = "black", fill = "white") +
  ylab('Number of Delayed Flights') +
  xlab('Day of the Month') +
  ggtitle('Distribution of Delayed Flights in December')
```

***Burke's Plot:***

***Drew's Plot:***
```{r, echo=FALSE}
library(tidyverse)
library(dplyr)
#filter by delayed flights
delayed <- filter(COflights, DEST == "DEN", ARR_DELAY >= 15, !is.na(ARR_TIME))

#filter by each type
carrier <- filter(delayed, CARRIER_DELAY >= 1) 
weather <- filter(delayed, WEATHER_DELAY >= 1)
nas <- filter(delayed, NAS_DELAY >= 1)
security <- filter(delayed, SECURITY_DELAY >= 1)

#mean delay per type
a_c <- mean(carrier$CARRIER_DELAY)
a_w <- mean(weather$WEATHER_DELAY)
a_n <- mean(nas$NAS_DELAY)
a_s <- mean(security$SECURITY_DELAY)
means <- c(a_c, a_w, a_n, a_s)

#total num of delays per type
t_c <- carrier %>% summarise(n())
t_w <- weather %>% summarise(n())
t_n <- nas %>% summarise(n())
t_s <- security %>% summarise(n())
totals <- c(17754, 1663, 18086, 89)


```

***Brandon's Plot:***

#Summary/Division of Labor: